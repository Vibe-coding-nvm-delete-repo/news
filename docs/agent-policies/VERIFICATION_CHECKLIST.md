# ‚úÖ Verification Checklist - Fix Verification Mandate

**Purpose:** Final, objective audit before PR handoff. This is NOT optional - it's a mandatory governance checkpoint.

**When to Use:** Immediately after reporting fix completion and opening a Pull Request.

**Fix or Flag Rule:** If ANY check fails, you MUST either:

- üîß **Fix Immediately** (minor issues) ‚Üí New commit ‚Üí Restart verification
- üö© **Create New Issue** (major systemic issues) ‚Üí Continue verification on current PR

---

## üéØ The Complete Verification Protocol

### Phase 1: Core Acceptance Criteria ‚úÖ

#### 1.1 Original Issue Resolved

```bash
# Reproduce the original issue scenario
# Confirm the bug no longer occurs OR feature now works

# Document evidence:
- [ ] Exact steps to reproduce BEFORE fix (should fail)
- [ ] Same steps AFTER fix (should succeed)
- [ ] Screenshot/log output showing resolution
- [ ] Edge cases tested (boundary conditions, error paths)
```

**Evidence Required:**

- Log output, test output, OR screen validation
- Must demonstrate 100% resolution of Issue #[NUM]

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 1.2 Test Coverage

```bash
# Verify test was added/modified
git diff main --name-only | grep test

# Run the specific test
npm test -- <test-file-path>
```

**Criteria:**

- [ ] ‚â•1 unit test added or adjusted
- [ ] Test specifically covers the fixed bug/new feature
- [ ] Test prevents future recurrence
- [ ] Test passes in isolation
- [ ] Test passes in full suite

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 1.3 Audit Score Improvement (If Applicable)

**Only if the issue was generated by PQA Policy**

```bash
# Re-run quality audit tool
# Compare score before vs after
```

**Criteria:**

- [ ] Underlying quality issue structurally improved
- [ ] Score increased or problem resolved
- [ ] No new quality issues introduced

**Status:** ‚òê PASS / ‚òê N/A / ‚òê FAIL

---

#### 1.4 Documentation Update

```bash
# Check if external docs need updating
ls docs/ README.md CHANGELOG.md

# Review if API signatures changed
git diff main -- '*.ts' '*.tsx' | grep -E '(export|interface|type)'
```

**Criteria:**

- [ ] README.md updated (if public API changed)
- [ ] API documentation updated (if endpoints/interfaces changed)
- [ ] CHANGELOG.md entry added (if user-facing change)
- [ ] Code comments added for complex logic

**Status:** ‚òê PASS / ‚òê N/A / ‚òê FAIL

---

#### 1.5 Functional Testing of All Paths

```bash
# Test happy path
# Test error paths (network failure, malformed input)
# Test edge cases (empty arrays, null values, boundary conditions)
```

**Scenarios to Validate:**

- [ ] **Happy Path:** Normal, expected usage works
- [ ] **Error Path 1:** Network/API failure handled gracefully
- [ ] **Error Path 2:** Invalid input rejected with clear error
- [ ] **Edge Case 1:** Boundary conditions (0, -1, MAX_INT, empty, null)
- [ ] **Edge Case 2:** Concurrent operations (if applicable)

**Status:** ‚òê PASS / ‚òê FAIL

---

### Phase 2: Policy & Regression Check üîí

#### 2.1 Policy Compliance

```bash
# List all modified files
git diff main --name-only

# Compare against approved mode allowlist
```

**Criteria:**

- [ ] All modified files are within approved mode's allowlist
- [ ] If Mode 3: All files ‚äÜ PROPOSED_FILES.txt
- [ ] No unapproved files touched
- [ ] Mode correctly declared in commit message

**Modified Files:**

```
<paste output of git diff main --name-only>
```

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 2.2 No New Warnings

```bash
# CRITICAL: FAILURE HERE TRIGGERS IMMEDIATE FIX/RETRY

# Run linter
npm run lint -- --max-warnings=0

# Run TypeScript check
npx tsc --noEmit
```

**Criteria:**

- [ ] Linter: Zero warnings, zero errors
- [ ] TypeScript: Zero type errors
- [ ] No `@ts-ignore` or `@ts-expect-error` added without justification
- [ ] No `eslint-disable` added without justification

**Status:** ‚òê PASS / ‚òê FAIL ‚ö†Ô∏è (AUTO-FIX REQUIRED)

---

#### 2.3 Regression Suite

```bash
# Run full test suite
npm test -- --runInBand

# Compare results to baseline
# Identify any newly failing tests
```

**Criteria:**

- [ ] All previously passing tests still pass
- [ ] Zero new test failures
- [ ] No skipped tests (`.skip` or `xit`)
- [ ] Test execution time hasn't significantly increased (>20%)

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 2.4 Deployment Artifact Check

```bash
# Run production build
npm run build

# Check build output
ls -lh .next/   # or dist/ or build/

# Compare bundle sizes
```

**Criteria:**

- [ ] Build succeeds without errors
- [ ] No significant bundle size increase (>10% without justification)
- [ ] Generated assets valid (HTML, CSS, JS)
- [ ] Source maps generated (if configured)

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 2.5 Operational Readiness (CRITICAL)

##### 2.5a Configuration Review

```bash
# Check for new environment variables
git diff main -- .env.example .env.local

# Check code for new process.env references
git diff main | grep -E 'process\.env\.'
```

**Criteria:**

- [ ] All new environment variables documented in `.env.example`
- [ ] No secrets hardcoded in source code
- [ ] User notified of required production environment config
- [ ] Default values provided where safe

**New Environment Variables:**

```
<list any new process.env.VAR_NAME or "None">
```

**Status:** ‚òê PASS / ‚òê FAIL

---

##### 2.5b Observability Hook

```bash
# Check for logging/metrics/tracing
git diff main | grep -E '(logger\.|console\.|metrics\.|trace\.)'
```

**Criteria:**

- [ ] Error scenarios logged with context
- [ ] Critical operations have observability hooks
- [ ] No sensitive data in logs (PII, passwords, tokens)
- [ ] Log levels appropriate (debug/info/warn/error)

**Status:** ‚òê PASS / ‚òê N/A / ‚òê FAIL

---

### Phase 3: Architectural & Clean-Up Audit üßπ

#### 3.1 Clean Artifacts (CRITICAL)

```bash
# FAILURE HERE TRIGGERS IMMEDIATE FIX/RETRY

# Check for debug code
git diff main | grep -E '(console\.log|debugger|XXX|TODO|FIXME)'

# Check for commented code
git diff main | grep -E '^\+.*\/\/'
```

**Criteria:**

- [ ] Zero `console.log` or `debugger` statements
- [ ] Zero commented-out code blocks
- [ ] Zero temporary test files (e.g., `test.tmp.ts`)
- [ ] Zero `TODO` or `FIXME` without issue number

**Status:** ‚òê PASS / ‚òê FAIL ‚ö†Ô∏è (AUTO-FIX REQUIRED)

---

#### 3.2 Dependency Delta

```bash
# Check package.json changes
git diff main -- package.json

# List installed dependencies
npm ls <package-name>
```

**Criteria:**

- [ ] All added dependencies are actually imported/used
- [ ] No duplicate dependencies (check npm ls output)
- [ ] Dependency versions appropriate (caret/tilde/pinned per policy)
- [ ] No dev dependencies in `dependencies` section

**Dependencies Added:**

```
<list any new packages or "None">
```

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 3.3 Architectural Integrity

```bash
# Review design plan (if existed)
# Compare implementation to agreed interfaces
```

**Criteria:**

- [ ] Implementation matches design plan (if applicable)
- [ ] Interface contracts respected
- [ ] Architectural boundaries maintained (e.g., no UI logic in data layer)
- [ ] Separation of concerns preserved

**Status:** ‚òê PASS / ‚òê N/A / ‚òê FAIL

---

#### 3.4 Future-Proofing & Systemic Flaws (FIX OR FLAG)

##### Minor Fixes/Cleanup

**If you identify simple refactoring opportunities:**

```bash
# Example: Extract repeated logic to helper function
# Example: Simplify conditional block
# Example: Rename unclear variable
```

**Action Required:**

- [x] Fix immediately
- [x] Add to current commit
- [x] Restart verification

**Fixes Applied:**

```
<list any minor improvements made or "None">
```

---

##### Major Systemic Flaws

**If the fix was blocked/complicated by deep structural issues:**

**Examples:**

- Poor database schema requiring complex workarounds
- Shared mutable state causing race conditions
- Unowned legacy module preventing clean interface
- Architectural debt (e.g., God class, circular dependencies)

**Action Required:**

- [x] Create new PQA issue (P1/P2 priority)
- [x] Link current PR as evidence
- [x] Continue verification on current PR

**New PQA Issues Created:**

```
<list issue numbers or "None">
```

**Status:** ‚òê PASS / ‚òê FLAGGED (issues created)

---

### Phase 4: PR Hygiene Check üìã

#### 4.1 Branch Integrity

```bash
# Check branch name
git branch --show-current

# Check PR title
gh pr view --json title
```

**Criteria:**

- [ ] Branch name starts with `ai/`
- [ ] Branch name format: `ai/<NUM>-<kebab>-<YYYYMMDDHHmm>`
- [ ] PR title starts with `fix:` or `feat:` or `refactor:`
- [ ] PR title includes issue number: `(Fixes #<NUM>)`

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 4.2 Artifact Review

```bash
# Check commit message
git log -1 --pretty=format:"%B"
```

**Criteria:**

- [ ] Commit message includes `Mode: <N>`
- [ ] Commit message includes `RCA:` section (3-5 lines)
- [ ] Commit message includes `Tests:` section
- [ ] RCA is specific and technical (not vague)

**Status:** ‚òê PASS / ‚òê FAIL

---

#### 4.3 Non-Merge Rule (CRITICAL)

```bash
# Verify PR is not auto-merged or merged by agent
gh pr view --json mergedBy
```

**Criteria:**

- [ ] PR is NOT merged
- [ ] PR status is "Open" or "Ready for Review"
- [ ] No merge commit created
- [ ] Merge queue not triggered

**Status:** ‚òê PASS / ‚òê FAIL

---

## üìä Final Output Format

After completing ALL checks, generate this report:

```markdown
‚úÖ VERIFICATION STATUS: [PASS or FAIL]

---

### üß™ Fix Audit for Issue #[ISSUE_NUMBER]

**Original Goal:** [Copy the original acceptance criteria]

**1. Core Fix Status:**

- Issue Resolved: [PASS/FAIL] ‚Äî [Evidence/Confirmation]
- New Test Added: [YES/NO] ‚Äî [File reference]
- Docs Updated: [YES/NO] ‚Äî [List files or N/A]
- Error Paths Validated: [PASS/FAIL]
- All Paths Tested: [PASS/FAIL]

**2. Policy & Regression Status:**

- Policy Mode Used: [Mode N] ‚Äî Files Touched: [List]
- Linter/TS Check: [PASS/FAIL] ‚Äî (Zero new warnings)
- Full Test Suite: [PASS/FAIL] ‚Äî (Zero regressions)
- Deployment Build: [PASS/FAIL] ‚Äî (Successful build)
- **Operational Readiness:** [PASS/FAIL] ‚Äî (Config/Secrets: [list or N/A])

**3. Architectural & Clean-Up Status:**

- Clean Artifacts: [PASS/FAIL] ‚Äî (Zero debug code)
- Dependency Audit: [PASS/FAIL] ‚Äî (No unnecessary installs)
- Architectural Adherence: [PASS/N/A]
- Simplicity Audit: [PASS/FLAGGED] ‚Äî (Issues: [list or "None"])

**4. PR Hygiene:**

- Branch/Title Format: [PASS/FAIL]
- Commit Message: [PASS/FAIL]
- Non-Merge Rule: [PASS/FAIL]

**5. Next Step:**

- If PASS: ‚úÖ PR is ready for human review. Setting status to "Ready for Review".
- If FAIL: üîß Creating follow-up commit to address: [list specific failures]

**6. Evidence Pack:**

- Build logs: [link or "local"]
- Test output: [link or "local"]
- Linter output: [link or "local"]
```

---

## üö® Failure Response Protocol

### If ANY Check Fails:

1. **Stop Immediately** - Do not proceed to next check
2. **Classify the Failure:**
   - **Minor:** Logic error, cleanup, missing log, policy violation ‚Üí FIX NOW
   - **Major:** Systemic issue, architectural flaw ‚Üí CREATE ISSUE
3. **Take Action:**
   - Minor: Create fix commit, re-run ALL checks from start
   - Major: Create PQA issue, continue verification on current PR
4. **Document:**
   - Add failure details to PR comment
   - Link to follow-up issue (if created)

### If Multiple Checks Fail:

- **DO NOT** batch fixes across multiple failed checks
- Fix ONE failure at a time
- Re-run verification after EACH fix

---

## üéØ Success Criteria

**Verification is COMPLETE only when:**

- ‚úÖ All Phase 1 checks = PASS
- ‚úÖ All Phase 2 checks = PASS
- ‚úÖ All Phase 3 checks = PASS or FLAGGED (with issues created)
- ‚úÖ All Phase 4 checks = PASS
- ‚úÖ Final output report generated
- ‚úÖ PR status set to "Ready for Review"

**DO NOT** mark verification complete if any checks are pending or skipped.

---

## üìö Related Documents

- [Mode Reference](./MODE_REFERENCE.md) - File allowlist/denylist rules
- [Templates](./TEMPLATES.md) - Commit message and PR body formats
- [Acceptance Criteria](./ACCEPTANCE_CRITERIA.md) - Detailed quality gates
- [Workflow Guide](./WORKFLOW_GUIDE.md) - Step-by-step implementation process
